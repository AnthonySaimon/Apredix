<!DOCTYPE html>
<html>

<head>
    <meta charset='utf-8'>
    <meta http-equiv='X-UA-Compatible' content='IE=edge'>
    <title>Chat</title>
    <meta name='viewport' content='width=device-width, initial-scale=1'>
    <link rel='stylesheet' type='text/css' media='screen' href='Main.css'>
    <link rel="shortcut icon" href="../imagem/Logo-aprendix.png" type="image/ico" />

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link
        href="https://fonts.googleapis.com/css2?family=Kodchasan:ital,wght@0,200;0,300;0,400;0,500;0,600;0,700;1,200;1,300;1,400;1,500;1,600;1,700&display=swap"
        rel="stylesheet">

</head>

<body>

    <nav class="menu-nav">

        <div class="menutoggle" id="menutoggle">
            <label for="check" class="menuButton">
                <input id="check" type="checkbox">
                <span class="top"></span>
                <span class="mid"></span>
                <span class="bot"></span>
            </label>
        </div>


        <div class="perfil">
            <h3>Usuario <br><samp>aaaaa</samp></h3>
            <div class="imgcx">
                <img src="https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcT9Etrj7SYknitFM3_TL7O2S1YoU7yswbXBLQ&s"
                    alt="...">
            </div>
        </div>
        <div class="menu">
            <ul>
                <li>
                    <a href="">
                        <ion-icon name="file-tray-outline"></ion-icon>
                        Biblioteca
                    </a>
                </li>
                <li>
                    <a href="../configuracao/index.html">
                        <ion-icon name="settings-outline"></ion-icon>
                        Comfigura√ß√£o
                    </a>
                </li>

                <li>
                    <a href="../Chat/index.html">
                        <ion-icon name="chatbox-ellipses-outline"></ion-icon>
                        Chat
                    </a>
                </li>

                <li>
                    <a href="../modelo_cusos/carrinho.html">
                        <ion-icon name="bag-outline"></ion-icon> Carrinho
                    </a>
                </li>

                <div class="menuextra">

                    <li class="menuextrali">
                        <a href="../sair.php">
                            <ion-icon name="log-out-outline"></ion-icon> Deslogar
                        </a>
                    </li>

                    <li class="menuextrali2">
                        <a href="../home/index.php">
                            <ion-icon name="home-outline"></ion-icon> Home
                        </a>
                    </li>

                </div>

            </ul>
        </div>
    </nav>

    <div class="chat-elemento" >
        

        <div class="aba-chat">
            <div class="conversas">
                <img src="../imagem/ECG_chat.png" alt="">
                <ul>
                    <h2>Nome do Chat<h2>
                            <li>Criador</li>
                </ul>
            </div>

            <a href="../add_chat/index.html">
                <div class="addchat">
                    <ion-icon name="add-outline"></ion-icon>
                </div>
            </a>

        </div>

        <div class="chat">
            <section class="chat__messages"></section> <!-- Onde as mensagens ser√£o exibidas -->
        
            <form class="caixachat" id="chatForm">
                <input placeholder="Digite aqui ..." class="input" name="text" type="text" id="messageInput">
                
                <!-- Bot√£o de "+" ao lado do bot√£o de enviar -->
                <button type="button" class="add-button" id="addButton">+</button>
        
                <!-- Bot√£o de enviar, agora tem o tipo 'submit' -->
                <button type="submit" class="buteviar">
                    <img src="../imagem/bxs-send.png" alt="">
                </button>
        
                <!-- Menu suspenso que ser√° mostrado quando clicar no bot√£o "+" -->
                <div class="dropdown-menu" id="dropdownMenu" style="display: none;">
                    <button type="button" class="location-button" id="locationButton">
                        üìç Enviar Localiza√ß√£o
                    </button>
                    <button class="camera-button">Enviar Foto</button> <!-- Novo bot√£o da c√¢mera -->
                </div>
            </form>
            <div class="camera-container" style="display: none;">
                <video id="video" width="300" height="300" autoplay></video>
                <button id="capture-button">Capturar Foto</button>
                <canvas id="canvas" style="display: none;"></canvas>
            </div>
            
        </div>
        
        

    <script>
        
        const chatForm = document.getElementById('chatForm');
        const messageInput = document.getElementById('messageInput');
        const chatMessages = document.querySelector('.chat__messages');
        const addButton = document.getElementById('addButton');
        const dropdownMenu = document.getElementById('dropdownMenu');
        const locationButton = document.getElementById('locationButton');

        // Enviar mensagem

   // Enviar mensagem
chatForm.addEventListener('submit', function(event) {
    event.preventDefault(); // Evitar o comportamento padr√£o do formul√°rio

    const messageText = messageInput.value.trim();
    if (messageText) {
        // Adicionar mensagem ao chat
        const messageElement = document.createElement('div');
        messageElement.textContent = messageText;
        messageElement.classList.add('message'); // Adicionar classe para estilizar a mensagem
        chatMessages.appendChild(messageElement);
        messageInput.value = ''; // Limpar o campo de entrada
        chatMessages.scrollTop = chatMessages.scrollHeight; // Rolagem para a mensagem mais recente
    }
});



        // Mostrar/Ocultar menu suspenso
        addButton.addEventListener('click', function() {
            dropdownMenu.style.display = dropdownMenu.style.display === 'none' ? 'block' : 'none';
        });

        // Enviar localiza√ß√£o
        locationButton.addEventListener('click', function() {
            if (navigator.geolocation) {
                navigator.geolocation.getCurrentPosition(function(position) {
                    const lat = position.coords.latitude;
                    const lon = position.coords.longitude;
                    // Adicionar a localiza√ß√£o ao chat
                    const locationMessage = `Localiza√ß√£o: https://www.google.com/maps?q=${lat},${lon}`;
                    const messageElement = document.createElement('div');
                    messageElement.textContent = locationMessage;
                    chatMessages.appendChild(messageElement);
                    chatMessages.scrollTop = chatMessages.scrollHeight; // Rolagem para a mensagem mais recente
                    dropdownMenu.style.display = 'none'; // Fechar o menu ap√≥s o envio
                });
            } else {
                alert('Geolocaliza√ß√£o n√£o √© suportada neste navegador.');
            }
        });
        document.querySelector('.camera-button').addEventListener('click', async () => {
    // Verifica se o navegador suporta o acesso √† c√¢mera
    if (navigator.mediaDevices && navigator.mediaDevices.getUserMedia) {
        try {
            // Pede permiss√£o para acessar a c√¢mera
            const stream = await navigator.mediaDevices.getUserMedia({ video: true });
            const video = document.getElementById('video');
            video.srcObject = stream;

            // Mostra o cont√™iner da c√¢mera
            document.querySelector('.camera-container').style.display = 'block';

            // Captura a foto ao clicar no bot√£o
            document.getElementById('capture-button').onclick = () => {
                const canvas = document.getElementById('canvas');
                const context = canvas.getContext('2d');
                canvas.width = video.videoWidth;
                canvas.height = video.videoHeight;
                context.drawImage(video, 0, 0);

                // Para o stream da c√¢mera
                stream.getTracks().forEach(track => track.stop());

                // Converte a imagem para URL de dados e envia
                const imageDataUrl = canvas.toDataURL('image/png');
                enviarImagemParaChat(imageDataUrl);

                // Oculta o cont√™iner da c√¢mera
                document.querySelector('.camera-container').style.display = 'none';
            };
        } catch (error) {
            console.error("Erro ao acessar a c√¢mera: ", error);
        }
    } else {
        alert("A c√¢mera n√£o √© suportada neste navegador.");
    }
});

// Fun√ß√£o para enviar a imagem para o chat
function enviarImagemParaChat(imageDataUrl) {
    // Crie uma nova mensagem com a imagem
    const messageContainer = document.createElement('div');
    messageContainer.className = 'message';
    const img = document.createElement('img');
    img.src = imageDataUrl;
    img.style.maxWidth = '100%'; // Limita o tamanho da imagem
    messageContainer.appendChild(img);

    // Adiciona a mensagem ao chat
    document.querySelector('.chat__messages').appendChild(messageContainer);
}

    </script>

</body>
</html>

        </div>
    

    </div>
    <script type="module" src="https://unpkg.com/ionicons@7.1.0/dist/ionicons/ionicons.esm.js"></script>
    <script nomodule src="https://unpkg.com/ionicons@7.1.0/dist/ionicons/ionicons.js"></script>
    <script src='../home/main.js'></script>


</body>




</html>